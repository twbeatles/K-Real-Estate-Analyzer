import{D as E,u as l,E as i}from"./index-Bj6dzIfW.js";const x=[e=>`https://api.allorigins.win/raw?url=${encodeURIComponent(e)}`,e=>`https://corsproxy.io/?${encodeURIComponent(e)}`,e=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(e)}`];async function q(e,t=5e3){const c=x.map(()=>new AbortController),o=x.map((r,n)=>{const a=r(e),u=c[n];return(async()=>{try{const s=setTimeout(()=>u.abort(),t),p=await fetch(a,{signal:u.signal,headers:{Accept:"application/rss+xml, application/xml, text/xml"}});if(clearTimeout(s),p.ok)return c.forEach((w,m)=>{m!==n&&w.abort()}),await p.text();throw new Error(`Proxy ${n} returned ${p.status}`)}catch(s){throw s.name==="AbortError"||l.warn(`프록시 ${n} 실패:`,s.message),s}})()});try{return await Promise.any(o)}catch{throw l.error("모든 CORS 프록시 실패"),new Error("모든 CORS 프록시 실패")}}const T=async(e="all")=>{const t={all:"부동산",market:"아파트+시세",policy:"부동산+정책",analysis:"부동산+전망",development:"재건축+재개발"},c=t[e]||t.all,o=`https://news.google.com/rss/search?q=${encodeURIComponent(c)}&hl=ko&gl=KR&ceid=KR:ko`;try{if(E()){const a=await q(o);return C(a)}const r=await fetch(`/api/rss?url=${encodeURIComponent(o)}`);if(!r.ok)throw new Error("RSS 피드 로드 실패");const n=await r.text();return C(n)}catch(r){return l.error("뉴스 로드 실패:",r),D(e)}};function D(e){return e==="all"?i:i.filter(t=>t.category===e)}function C(e){try{const c=new DOMParser().parseFromString(e,"text/xml"),o=c.querySelector("parsererror");if(o)return l.error("RSS 파싱 오류:",o.textContent),i;const r=c.querySelectorAll("item");if(r.length===0)return l.warn("RSS 피드에 항목이 없음, 데모 데이터 사용"),i;const n=[];return r.forEach((a,u)=>{var y,d,h,S,g;if(u>=20)return;const s=((y=a.querySelector("title"))==null?void 0:y.textContent)||"",p=((d=a.querySelector("link"))==null?void 0:d.textContent)||"",w=((h=a.querySelector("pubDate"))==null?void 0:h.textContent)||"",m=((S=a.querySelector("source"))==null?void 0:S.textContent)||"뉴스",R=(((g=a.querySelector("description"))==null?void 0:g.textContent)||"").replace(/<[^>]*>/g,"").substring(0,200);let f;try{f=new Date(w).toISOString().split("T")[0]}catch{f=new Date().toISOString().split("T")[0]}n.push({id:u+1,title:s.replace(" - "+m,""),summary:R,source:m,date:f,link:p,category:k(s),sentiment:I(s)})}),n.length>0?n:i}catch(t){return l.error("RSS 파싱 실패:",t),i}}function k(e){const t=e.toLowerCase();return t.includes("정책")||t.includes("규제")||t.includes("법")?"policy":t.includes("전망")||t.includes("분석")||t.includes("예측")?"analysis":t.includes("재건축")||t.includes("재개발")||t.includes("gtx")?"development":"market"}function I(e){const t=["상승","호조","활기","급등","회복","호재","증가","최고"],c=["하락","급락","침체","위기","폭락","감소","최저","규제"],o=e.toLowerCase();for(const r of t)if(o.includes(r))return"positive";for(const r of c)if(o.includes(r))return"negative";return"neutral"}export{T as f};
//# sourceMappingURL=newsService-DtYqLLyP.js.map
