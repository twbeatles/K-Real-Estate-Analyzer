import{E as q,u as p,F as u}from"./index-BYBhPLOX.js";const C=[t=>`https://api.allorigins.win/raw?url=${encodeURIComponent(t)}`,t=>`https://corsproxy.io/?${encodeURIComponent(t)}`,t=>`https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(t)}`];async function k(t,e=5e3){var r;const c=C.map(()=>new AbortController),s=C.map((n,o)=>{const l=n(t),a=c[o];return(async()=>{try{const i=setTimeout(()=>a.abort(),e),m=await fetch(l,{signal:a.signal,headers:{Accept:"application/rss+xml, application/xml, text/xml"}});if(clearTimeout(i),m.ok)return c.forEach((w,f)=>{f!==o&&w.abort()}),await m.text();throw new Error(`Proxy ${o} returned ${m.status}`)}catch(i){throw i.name==="AbortError"||p.warn(`프록시 ${o} 실패:`,i.message),i}})()});try{return await Promise.any(s)}catch(n){const o=(r=n.errors)==null?void 0:r.map((l,a)=>`Proxy ${a}: ${l.message}`).join(", ");throw p.error("모든 CORS 프록시 실패:",o||n.message),new Error("뉴스를 가져올 수 없습니다. 네트워크 연결을 확인해주세요.")}}const T=async(t="all")=>{const e={all:"부동산",market:"아파트+시세",policy:"부동산+정책",analysis:"부동산+전망",development:"재건축+재개발"},c=e[t]||e.all,s=`https://news.google.com/rss/search?q=${encodeURIComponent(c)}&hl=ko&gl=KR&ceid=KR:ko`;try{if(q()){const o=await k(s);return R(o)}const r=await fetch(`/api/rss?url=${encodeURIComponent(s)}`);if(!r.ok)throw new Error("RSS 피드 로드 실패");const n=await r.text();return R(n)}catch(r){return p.error("뉴스 로드 실패:",r),D(t)}};function D(t){return t==="all"?u:u.filter(e=>e.category===t)}function R(t){try{const c=new DOMParser().parseFromString(t,"text/xml"),s=c.querySelector("parsererror");if(s)return p.error("RSS 파싱 오류:",s.textContent),u;const r=c.querySelectorAll("item");if(r.length===0)return p.warn("RSS 피드에 항목이 없음, 데모 데이터 사용"),u;const n=[];return r.forEach((o,l)=>{var d,h,g,S,x;if(l>=20)return;const a=((d=o.querySelector("title"))==null?void 0:d.textContent)||"",i=((h=o.querySelector("link"))==null?void 0:h.textContent)||"",m=((g=o.querySelector("pubDate"))==null?void 0:g.textContent)||"",w=((S=o.querySelector("source"))==null?void 0:S.textContent)||"뉴스",E=(((x=o.querySelector("description"))==null?void 0:x.textContent)||"").replace(/<[^>]*>/g,"").substring(0,200);let y;try{y=new Date(m).toISOString().split("T")[0]}catch{y=new Date().toISOString().split("T")[0]}n.push({id:l+1,title:a.replace(" - "+w,""),summary:E,source:w,date:y,link:i,category:$(a),sentiment:I(a)})}),n.length>0?n:u}catch(e){return p.error("RSS 파싱 실패:",e),u}}function $(t){const e=t.toLowerCase();return e.includes("정책")||e.includes("규제")||e.includes("법")?"policy":e.includes("전망")||e.includes("분석")||e.includes("예측")?"analysis":e.includes("재건축")||e.includes("재개발")||e.includes("gtx")?"development":"market"}function I(t){const e=["상승","호조","활기","급등","회복","호재","증가","최고"],c=["하락","급락","침체","위기","폭락","감소","최저","규제"],s=t.toLowerCase();for(const r of e)if(s.includes(r))return"positive";for(const r of c)if(s.includes(r))return"negative";return"neutral"}export{T as f};
//# sourceMappingURL=newsService-LmJQZJtI.js.map
